{"ast":null,"code":"var _jsxFileName = \"/Users/icdoleo/HDocuments/dev/synchrify-frontend/src/pages/Dashboard/index.js\";\nimport React, { useState, useEffect } from \"react\";\nimport history from '../../services/history';\n\nconst Dashboard = () => {\n  let isLoggedIn = false;\n  let isLinkedtoSpotify = false;\n  useEffect(() => {\n    fetch('http://127.0.0.1:8000/spotify/user/profile', {\n      method: 'GET',\n      credentials: 'include'\n    }).then(resp => {\n      return resp.json();\n    }).then(data => {\n      console.log(data);\n\n      if (data.error === \"You must be logged in to access this URL\") {// history.push('/');\n      } else if (data.error === \"You must be authenticated with Spotify to access this URL\") {\n        // history.push('/linkspotify');\n        isLoggedIn = true;\n      }\n\n      isLoggedIn = true;\n      isLinkedtoSpotify = true;\n      return userInfoHandler(data);\n    }).catch(err => {\n      return console.error(err);\n    });\n    fetch('http://127.0.0.1:8000/spotify/user/playing_track', {\n      method: 'GET',\n      credentials: 'include'\n    }).then(resp => {\n      return resp.json();\n    }).then(data => {\n      return currentlyListeningHandler(data.item);\n    }).catch(err => {\n      currentlyListeningHandler('');\n      return console.error(err);\n    });\n    fetch('http://127.0.0.1:8000/spotify/user/recent_tracks', {\n      method: 'GET',\n      credentials: 'include'\n    }).then(resp => {\n      return resp.json();\n    }).then(data => {\n      return recentlyPlayedListHandler(data.items);\n    }).catch(err => {\n      return console.error(err);\n    });\n    fetch('http://127.0.0.1:8000/spotify/user/top_tracks?timespan=short_term&limit=7', {\n      method: 'GET',\n      credentials: 'include'\n    }).then(resp => {\n      return resp.json();\n    }).then(data => {\n      return topTracksHandler(data.items);\n    }).catch(err => {\n      return console.error(err);\n    });\n  }, []);\n  const [userDisplayName, setUserDisplayName] = useState('');\n  const [isListening, setIsListening] = useState(false);\n  const [currentlyListening, setCurrentlyListening] = useState([]);\n  const [recentlyPlayedList, setRecentlyPlayedList] = useState([]);\n\n  const userInfoHandler = props => {\n    setUserDisplayName(props.display_name + '\\'s ');\n  };\n\n  const currentlyListeningHandler = props => {\n    // FIXME: array with only 1 item\n    if (props === '') {// User is not listening to anything\n    } else {\n      setIsListening(true);\n      const array = [];\n      array.push({\n        id: 1,\n        value: props.artists[0].name + ' - ' + props.name\n      });\n      setCurrentlyListening(array.map(array => /*#__PURE__*/React.createElement(\"li\", {\n        key: array.id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 9\n        }\n      }, array.value)));\n    }\n  };\n\n  const recentlyPlayedListHandler = props => {\n    const array = [];\n\n    for (let i = 0; i < props.length; i++) {\n      array.push({\n        id: i,\n        value: props[i].track.artists[0].name + ' - ' + props[i].track.name\n      });\n    }\n\n    setRecentlyPlayedList(array.map(array => /*#__PURE__*/React.createElement(\"li\", {\n      key: array.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 7\n      }\n    }, array.value))); // console.log(array);\n    // console.log(props);\n  };\n\n  async function fetchTopTracks() {\n    const url = 'http://127.0.0.1:8000/spotify/user/top_tracks' + topTracksTimeLimit;\n    console.log(url);\n    fetch(url, {\n      method: 'GET',\n      credentials: 'include'\n    }).then(resp => {\n      return resp.json();\n    }).then(data => {\n      return topTracksHandler(data.items);\n    }).catch(err => {\n      return console.error(err);\n    });\n  }\n\n  ;\n  const topTracksTimeLimitDef = {\n    short: '?timespan=short_term&limit=7',\n    medium: '?timespan=medium_term&limit=7',\n    long: '?timespan=long_term&limit=7'\n  };\n  let topTracksTimeLimit = '';\n  const [topTracks, setTopTracks] = useState([]);\n  const [topTracksStatus, setTopTracksStatus] = useState('the past 4 weeks:');\n\n  const switchTimeFrame = props => {\n    console.log(props);\n\n    if (props === '4 weeks') {\n      topTracksTimeLimit = topTracksTimeLimitDef.short;\n      setTopTracksStatus('the past 4 weeks:');\n    } else if (props === '6 months') {\n      //setTopTracksTimeLimit(topTracksTimeLimitDef.medium);\n      topTracksTimeLimit = topTracksTimeLimitDef.medium;\n      setTopTracksStatus('the past 6 months:');\n    } else if (props === 'all time') {\n      //setTopTracksTimeLimit(topTracksTimeLimitDef.long);\n      topTracksTimeLimit = topTracksTimeLimitDef.long;\n      setTopTracksStatus('all time:');\n    }\n\n    console.log(topTracksTimeLimit);\n    fetchTopTracks(topTracksTimeLimit);\n  };\n\n  const topTracksHandler = props => {\n    console.log(props);\n    const array = [];\n\n    for (let i = 0; i < props.length; i++) {\n      array.push({\n        id: i,\n        value: props[i].artists[0].name + ' - ' + props[i].name\n      });\n    }\n\n    setTopTracks(array.map(array => /*#__PURE__*/React.createElement(\"li\", {\n      key: array.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 7\n      }\n    }, array.value)));\n    console.log(array);\n  };\n\n  if (isLoggedIn && isLinkedtoSpotify) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 9\n      }\n    }, userDisplayName, \" Dashboard\"), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 9\n      }\n    }, isListening && /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 13\n      }\n    }, \"Currently Playing\"), /*#__PURE__*/React.createElement(\"ul\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 13\n      }\n    }, currentlyListening))), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 11\n      }\n    }, \"Recently Played\"), /*#__PURE__*/React.createElement(\"ul\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 11\n      }\n    }, recentlyPlayedList)), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 11\n      }\n    }, \"Top Tracks\"), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: switchTimeFrame.bind(switchTimeFrame, '4 weeks'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 11\n      }\n    }, \"4 Weeks\"), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: switchTimeFrame.bind(switchTimeFrame, '6 months'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 11\n      }\n    }, \"6 Months\"), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: switchTimeFrame.bind(switchTimeFrame, 'all time'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 11\n      }\n    }, \"All Time\"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 11\n      }\n    }), \"Top tracks from \", topTracksStatus, /*#__PURE__*/React.createElement(\"ul\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 11\n      }\n    }, topTracks)), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"a\", {\n      href: \"/logout\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 11\n      }\n    }, \"Logout\")));\n  } else if (isLoggedIn) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"a\", {\n      href: \"'http://127.0.0.1:8000/spotify/auth'\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 9\n      }\n    }, \"Link To Spotify\"));\n  } else {\n    history.push('/');\n  }\n};\n\nexport default Dashboard;","map":{"version":3,"sources":["/Users/icdoleo/HDocuments/dev/synchrify-frontend/src/pages/Dashboard/index.js"],"names":["React","useState","useEffect","history","Dashboard","isLoggedIn","isLinkedtoSpotify","fetch","method","credentials","then","resp","json","data","console","log","error","userInfoHandler","catch","err","currentlyListeningHandler","item","recentlyPlayedListHandler","items","topTracksHandler","userDisplayName","setUserDisplayName","isListening","setIsListening","currentlyListening","setCurrentlyListening","recentlyPlayedList","setRecentlyPlayedList","props","display_name","array","push","id","value","artists","name","map","i","length","track","fetchTopTracks","url","topTracksTimeLimit","topTracksTimeLimitDef","short","medium","long","topTracks","setTopTracks","topTracksStatus","setTopTracksStatus","switchTimeFrame","bind"],"mappings":"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","sourcesContent":["import React, { useState , useEffect }from \"react\";\nimport history from '../../services/history';\n\nconst Dashboard = () => {\n  let isLoggedIn = false;\n  let isLinkedtoSpotify = false;\n  useEffect(() => { \n      fetch('http://127.0.0.1:8000/spotify/user/profile', {\n        method: 'GET',\n        credentials: 'include',\n      })\n      .then((resp) => {\n        return resp.json();\n      })\n      .then((data) => {\n        console.log(data);\n        if (data.error === \"You must be logged in to access this URL\") {\n          // history.push('/');\n        } else if (data.error === \"You must be authenticated with Spotify to access this URL\") {\n          // history.push('/linkspotify');\n          isLoggedIn = true;\n        } \n        isLoggedIn = true;\n        isLinkedtoSpotify = true;\n        return userInfoHandler(data);\n      })\n      .catch((err) => {\n        return console.error(err);\n      })\n\n      fetch('http://127.0.0.1:8000/spotify/user/playing_track', {\n        method: 'GET',\n        credentials: 'include',\n      })\n      .then((resp) => {\n        return resp.json();\n      })\n      .then((data) => {\n        return currentlyListeningHandler(data.item);\n      })\n      .catch((err) => {\n        currentlyListeningHandler('');\n        return console.error(err);\n      })\n\n      fetch('http://127.0.0.1:8000/spotify/user/recent_tracks', {\n        method: 'GET',\n        credentials: 'include',\n      })\n      .then((resp) => {\n        return resp.json();\n      })\n      .then((data) => {\n        return recentlyPlayedListHandler(data.items);\n      })\n      .catch((err) => {\n        return console.error(err);\n      })\n\n      fetch('http://127.0.0.1:8000/spotify/user/top_tracks?timespan=short_term&limit=7', {\n        method: 'GET',\n        credentials: 'include'\n      })\n      .then((resp) => {\n        return resp.json();\n      })\n      .then((data) => {\n        return topTracksHandler(data.items);\n      })\n      .catch((err) => {\n        return console.error(err);\n      })\n  }, [])\n\n  const [userDisplayName, setUserDisplayName] = useState('');\n  \n  const [isListening, setIsListening] = useState(false);\n  const [currentlyListening, setCurrentlyListening] = useState([]);\n\n  const [recentlyPlayedList, setRecentlyPlayedList] = useState([]);\n\n  const userInfoHandler = (props) => {\n    setUserDisplayName(props.display_name + '\\'s ');\n  };\n\n  const currentlyListeningHandler = (props) => {\n    // FIXME: array with only 1 item\n    if (props === '') {\n      // User is not listening to anything\n    } else {\n      setIsListening(true);\n      const array = [];\n      array.push({\n        id: 1,\n        value: props.artists[0].name + ' - ' + props.name\n      });\n      setCurrentlyListening(array.map((array) => \n        <li key={array.id}>{array.value}</li>\n      ));\n    }\n  };\n\n  const recentlyPlayedListHandler = (props) => {\n    const array = [];\n    for (let i = 0; i < props.length; i++) {\n      array.push({\n        id: i,\n        value: props[i].track.artists[0].name + ' - ' + props[i].track.name\n      });\n    }\n    setRecentlyPlayedList(array.map((array) =>\n      <li key={array.id}>{array.value}</li>\n    ));\n    // console.log(array);\n    // console.log(props);\n  };\n\n  async function fetchTopTracks() {\n    const url = 'http://127.0.0.1:8000/spotify/user/top_tracks'+topTracksTimeLimit;\n    console.log(url);\n    fetch(url, {\n      method: 'GET',\n      credentials: 'include'\n    })\n    .then((resp) => {\n      return resp.json();\n    })\n    .then((data) => {\n      return topTracksHandler(data.items);\n    })\n    .catch((err) => {\n      return console.error(err);\n    })\n  };\n  const topTracksTimeLimitDef = {\n    short: '?timespan=short_term&limit=7',\n    medium: '?timespan=medium_term&limit=7',\n    long: '?timespan=long_term&limit=7'\n  };\n\n  let topTracksTimeLimit = '';\n  const [topTracks, setTopTracks] = useState([]);\n  const [topTracksStatus, setTopTracksStatus] = useState('the past 4 weeks:');\n\n  const switchTimeFrame = (props) => {\n    console.log(props);\n    if (props === '4 weeks') {\n      topTracksTimeLimit = topTracksTimeLimitDef.short;\n      setTopTracksStatus('the past 4 weeks:');\n    } else if (props === '6 months'){\n      //setTopTracksTimeLimit(topTracksTimeLimitDef.medium);\n      topTracksTimeLimit = topTracksTimeLimitDef.medium;\n      setTopTracksStatus('the past 6 months:');\n    } else if (props === 'all time'){\n      //setTopTracksTimeLimit(topTracksTimeLimitDef.long);\n      topTracksTimeLimit = topTracksTimeLimitDef.long;\n      setTopTracksStatus('all time:');\n    }\n    console.log(topTracksTimeLimit)\n    fetchTopTracks(topTracksTimeLimit);\n  };\n  \n  const topTracksHandler = (props) => {\n    console.log(props);\n    const array = [];\n    for (let i = 0; i < props.length; i++) {\n      array.push({\n        id: i,\n        value: props[i].artists[0].name + ' - ' + props[i].name\n      });\n    }\n    setTopTracks(array.map((array) =>\n      <li key={array.id}>{array.value}</li>\n    ));\n    console.log(array);\n  };\n\n  if (isLoggedIn && isLinkedtoSpotify) {\n    return (\n        <div>\n        <h1>{userDisplayName} Dashboard</h1>\n        <div>\n          {isListening && \n            <div>\n            <h2>Currently Playing</h2>\n            <ul>\n              {currentlyListening}\n            </ul>\n            </div>\n          }\n        </div>\n\n        <div>\n          <h2>Recently Played</h2>\n          <ul>\n            {recentlyPlayedList}\n          </ul>\n        </div>\n\n        <div>\n          <h2>Top Tracks</h2>\n          <button onClick={switchTimeFrame.bind(switchTimeFrame, '4 weeks')}>\n            4 Weeks\n          </button>\n          <button onClick={switchTimeFrame.bind(switchTimeFrame, '6 months')}>\n            6 Months\n          </button>\n          <button onClick={switchTimeFrame.bind(switchTimeFrame, 'all time')}>\n            All Time\n          </button>\n          <br/>\n          Top tracks from {topTracksStatus}\n          <ul>\n            {topTracks}\n          </ul>\n        </div>\n\n        <div>\n          <a href='/logout'>Logout</a>\n        </div>\n      </div>\n    )\n  }\n  else if (isLoggedIn) {\n    return (\n      <div>\n        <a href=\"'http://127.0.0.1:8000/spotify/auth'\">Link To Spotify</a>\n      </div>\n    );\n  } else {\n    history.push('/');\n  }\n};\n\nexport default Dashboard;"]},"metadata":{},"sourceType":"module"}